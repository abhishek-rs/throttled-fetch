"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("cross-fetch"),r=function(e,t){return Math.round((e.valueOf()-t.valueOf())/1e3)},n=new Map,u=function(e,t,n){return e.values.reduce((function(e,u){var a=u.time,s=u.requests,o=u.accepts;return a&&r(t,a)<n?[e[0]+s,e[1]+o]:e}),[0,0])},a=function(e,t,u,a,s){void 0===a&&(a=!1),void 0===s&&(s=!1);var o=n.get(e);if(o){var i=o.values,c=r(t,o.head);if(c>=u)i[0]={requests:a?1:0,accepts:s?1:0,time:t},n.set(e,{head:t,values:i});else{var f=i[c];i[c]={requests:a?f.requests+1:f.requests,accepts:s?f.accepts+1:f.accepts,time:t}}}},s={K:2,windowLength:120,cleanupFrequency:60},o=function(t){var o=void 0===t?s:t,i=o.K,c=void 0===i?2:i,f=o.windowLength,v=void 0===f?120:f,d=o.cleanupFrequency,l=void 0===d?60:d;return function(t){e||(e=setInterval(function(e){return function(){n.forEach((function(t,u){var a=t.head;r(new Date,a)>2.5*e&&n.delete(u)}))}}(v),1e3*l));var s=new Date;n.has(t)||n.set(t,function(e,t){return{head:e,values:new Array(t).fill({requests:0,accepts:0,time:null})}}(s,v));var o=n.get(t),i=u(o,s,v),f=i[0],d=Math.max(0,(f-c*i[1])/(f+1));return Math.random()<d?[!0,function(e){return e}]:[!1,function(e){return a(t,s,v,!0,e)}]}};exports.default=function(e){return function(r,n,u,a,s){var i;if(void 0===n&&(n={}),void 0===u&&(u=!0),void 0===a&&(a=!0),void 0===s&&(s=!1),u){var c,f=o(e);c=r instanceof URL?r.href:r;var v=f(a?function(e){return e.split("?")[0]}(c):c);if(i=v[1],v[0])return i(!1),Promise.reject(new Error("The request was throttled."))}var d=s?400:500;return t(r,n).then((function(e){return u&&i((null==e?void 0:e.status)<d),e})).catch((function(e){throw"AbortError"===e.name||u&&i(!1),e}))}},exports.diffInSeconds=r,exports.getRequestValues=u,exports.requestsMap=n,exports.throttler=o,exports.updateRequestValues=a;
//# sourceMappingURL=throttled-fetch.cjs.production.min.js.map
